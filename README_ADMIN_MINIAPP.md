# Admin Mini App

–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –¥–ª—è –±–æ—Ç–∞ LOOV —Å **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π** –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π Cloudflare Tunnel.

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ cloudflared

**Ubuntu/Debian:**
```bash
curl -L https://github.com/cloudflare/cloudflared/releases/latest/download/cloudflared-linux-amd64.deb -o cloudflared.deb
sudo dpkg -i cloudflared.deb
```

**macOS:**
```bash
brew install cloudflared
```

**Windows:**
–°–∫–∞—á–∞–π—Ç–µ —Å https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/downloads/

### 2. –î–æ–±–∞–≤—å—Ç–µ —Å–≤–æ–π Telegram ID –≤ —Å–ø–∏—Å–æ–∫ –∞–¥–º–∏–Ω–æ–≤

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `app/admin/security.py`:
```python
ADMIN_WHITELIST: set[int] = {–í–ê–®_TELEGRAM_ID}
```
*(–£–∑–Ω–∞—Ç—å ID –º–æ–∂–Ω–æ —á–µ—Ä–µ–∑ –±–æ—Ç–∞ @userinfobot)*

### 3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ URL –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ –≤ `.env`

```
ADMIN_WEBAPP_URL=https://loov.pages.dev
```

### 4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞

```bash
python manage.py run
```

### 5. –ì–æ—Ç–æ–≤–æ!

–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –±–æ—Ç–∞ –≤—ã —É–≤–∏–¥–∏—Ç–µ –≤ –ª–æ–≥–∞—Ö:
```
üîê Admin –ø–∞–Ω–µ–ª—å –¥–æ—Å—Ç—É–ø–Ω–∞: https://xxx-xxx-xxx.trycloudflare.com/admin
```

–û—Ç–ø—Ä–∞–≤—å—Ç–µ `/admin` –±–æ—Ç—É –≤ Telegram ‚Äî –ø–æ—è–≤–∏—Ç—Å—è –∫–Ω–æ–ø–∫–∞ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –ø–∞–Ω–µ–ª–∏.

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Telegram      ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ  loov.pages.dev      ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ  Cloudflare Tunnel (HTTPS)  ‚îÇ
‚îÇ   WebApp        ‚îÇ     ‚îÇ  (Frontend)          ‚îÇ     ‚îÇ  xxx.trycloudflare.com      ‚îÇ
‚îÇ                 ‚îÇ     ‚îÇ                      ‚îÇ     ‚îÇ           ‚îÇ                 ‚îÇ
‚îÇ                 ‚îÇ     ‚îÇ  config.js ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îÇ                             ‚îÇ
                                                     ‚ñº                             ‚îÇ
                                               ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                       ‚îÇ
                                               ‚îÇ VPS:8080  ‚îÇ‚óÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                               ‚îÇ Admin API ‚îÇ
                                               ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

1. **–ë–æ—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è** ‚Üí –∑–∞–ø—É—Å–∫–∞–µ—Ç Admin API –Ω–∞ –ø–æ—Ä—Ç—É 8080
2. **Cloudflare Tunnel —Å—Ç–∞—Ä—Ç—É–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** ‚Üí —Å–æ–∑–¥–∞—ë—Ç HTTPS URL
3. **config.js –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è** —Å –Ω–æ–≤—ã–º URL —Ç—É–Ω–Ω–µ–ª—è
4. **Telegram WebApp** –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ —Å loov.pages.dev
5. **–§—Ä–æ–Ω—Ç–µ–Ω–¥** –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫ API —á–µ—Ä–µ–∑ —Ç—É–Ω–Ω–µ–ª—å

## –í–∞–∂–Ω–æ: –î–µ–ø–ª–æ–π –Ω–∞ Cloudflare Pages

–ü–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞, **–∑–∞–∫–æ–º–º–∏—Ç—å—Ç–µ –∏ –∑–∞–ø—É—à—å—Ç–µ** –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ `miniapps/admin/config.js`:

```bash
git add miniapps/admin/config.js
git commit -m "Update admin API URL"
git push
```

Cloudflare Pages –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–¥–µ–ø–ª–æ–∏—Ç –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥.

> **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** URL —Ç—É–Ω–Ω–µ–ª—è –º–µ–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ –±–æ—Ç–∞. –ü–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –Ω—É–∂–Ω–æ —Å–Ω–æ–≤–∞ –∑–∞–ø—É—à–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è.

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é |
|------------|----------|--------------|
| `ADMIN_WEBAPP_URL` | URL —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ (Cloudflare Pages) | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ |
| `ADMIN_API_HOST` | –•–æ—Å—Ç –¥–ª—è API —Å–µ—Ä–≤–µ—Ä–∞ | `0.0.0.0` |
| `ADMIN_API_PORT` | –ü–æ—Ä—Ç –¥–ª—è API —Å–µ—Ä–≤–µ—Ä–∞ | `8080` |

### –°–ø–∏—Å–æ–∫ –∞–¥–º–∏–Ω–æ–≤

–†–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `app/admin/security.py`:
```python
ADMIN_WHITELIST: set[int] = {123456789, 987654321}
```

## –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã API

| –≠–Ω–¥–ø–æ–∏–Ω—Ç | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|----------|
| `GET /admin` | UI –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ |
| `GET /admin/api/users` | API –¥–∞–Ω–Ω—ã—Ö (—Ç—Ä–µ–±—É–µ—Ç `X-Telegram-Init-Data`) |

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –ö–æ–º–∞–Ω–¥–∞ `/admin` –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤ –º–µ–Ω—é –±–æ—Ç–∞
- –ù–µ-–∞–¥–º–∏–Ω—ã –Ω–µ –ø–æ–ª—É—á–∞—é—Ç –æ—Ç–≤–µ—Ç–∞ –Ω–∞ `/admin`
- API —Ç—Ä–µ–±—É–µ—Ç –≤–∞–ª–∏–¥–Ω—ã–π Telegram `initData`
- CORS –≤–∫–ª—é—á—ë–Ω –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å Telegram WebApp

## –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### "Init data missing" / "Open inside Telegram"
- –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –¥–æ–ª–∂–Ω–∞ –æ—Ç–∫—Ä—ã–≤–∞—Ç—å—Å—è **—Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ Telegram** (–∫–Ω–æ–ø–∫–∞ WebApp)
- –û—Ç–∫—Ä—ã—Ç–∏–µ URL –≤ –æ–±—ã—á–Ω–æ–º –±—Ä–∞—É–∑–µ—Ä–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ù–µ—Ç –æ—Ç–≤–µ—Ç–∞ –Ω–∞ –∫–æ–º–∞–Ω–¥—É `/admin`
- –î–æ–±–∞–≤—å—Ç–µ —Å–≤–æ–π Telegram ID –≤ `ADMIN_WHITELIST`

### "Unable to load data" / –°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –±–æ—Ç –∑–∞–ø—É—â–µ–Ω
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ `TUNNEL_STARTED`
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `config.js` –æ–±–Ω–æ–≤–ª—ë–Ω –∏ –∑–∞–¥–µ–ø–ª–æ–µ–Ω –Ω–∞ Pages

### –ü—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç–∞, –µ—Å–ª–∏ –Ω–∏–∫—Ç–æ –µ—â—ë –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª –±–æ—Ç–∞
