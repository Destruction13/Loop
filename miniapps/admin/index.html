<!doctype html>
<html lang="ru">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <base href="/admin/" />
    <title>LOOV Admin</title>
    <meta name="color-scheme" content="light dark" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="styles.css" />
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
  </head>
  <body>
    <div class="app">
      <!-- Header -->
      <header class="header">
        <div class="header-top">
          <h1 class="logo">LOOV Admin</h1>
          <div class="header-actions">
            <button id="dashboardBtn" class="btn btn-dashboard" title="–î–∞—à–±–æ—Ä–¥">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20">
                <path d="M3 3v18h18"/>
                <path d="M18 17V9"/>
                <path d="M13 17V5"/>
                <path d="M8 17v-3"/>
              </svg>
              <span>–î–∞—à–±–æ—Ä–¥</span>
            </button>
            <button id="broadcastBtn" class="btn btn-broadcast" title="–†–∞—Å—Å—ã–ª–∫–∞">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20">
                <path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z"/>
              </svg>
              <span>–†–∞—Å—Å—ã–ª–∫–∞</span>
            </button>
            <div class="status-badge" id="statusBadge">
              <span class="status-dot"></span>
              <span class="status-text">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
            </div>
          </div>
        </div>
        
        <!-- Stats Cards -->
        <div class="stats-grid" id="statsGrid">
          <div class="stat-card">
            <div class="stat-value" id="statUsers">-</div>
            <div class="stat-label">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="statGenerations">-</div>
            <div class="stat-label">–ì–µ–Ω–µ—Ä–∞—Ü–∏–π</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="statPhones">-</div>
            <div class="stat-label">–° —Ç–µ–ª–µ—Ñ–æ–Ω–æ–º</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="statEvents">-</div>
            <div class="stat-label">–ò–≤–µ–Ω—Ç –ø–æ–ø—ã—Ç–æ–∫</div>
          </div>
        </div>
      </header>

      <!-- Search & Filters -->
      <div class="toolbar">
        <div class="search-box">
          <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8"/>
            <path d="m21 21-4.35-4.35"/>
          </svg>
          <input type="text" id="searchInput" placeholder="–ü–æ–∏—Å–∫ –ø–æ ID, username –∏–ª–∏ –∏–º–µ–Ω–∏..." />
        </div>
        <div class="toolbar-actions">
          <select id="sortSelect" class="select">
            <option value="generations">–ü–æ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è–º</option>
            <option value="tries_remaining">–ü–æ –ø–æ–ø—ã—Ç–∫–∞–º</option>
            <option value="user_id">–ü–æ ID</option>
            <option value="username">–ü–æ username</option>
          </select>
          <button id="refreshBtn" class="btn btn-icon" title="–û–±–Ω–æ–≤–∏—Ç—å">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>
              <path d="M3 3v5h5"/>
              <path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16"/>
              <path d="M16 21h5v-5"/>
            </svg>
          </button>
        </div>
      </div>

      <!-- Users List -->
      <div class="users-list" id="usersList">
        <!-- Users will be rendered here -->
      </div>

      <!-- Load More -->
      <div class="load-more-container" id="loadMoreContainer">
        <button id="loadMoreBtn" class="btn btn-secondary">–ó–∞–≥—Ä—É–∑–∏—Ç—å –µ—â—ë</button>
        <div class="users-count" id="usersCount">0 –∏–∑ 0</div>
      </div>

      <!-- Empty State -->
      <div class="empty-state hidden" id="emptyState">
        <div class="empty-icon">üì≠</div>
        <div class="empty-title">–ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
        <div class="empty-text">–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø—É—Å—Ç–∞</div>
      </div>

      <!-- Error State -->
      <div class="error-state hidden" id="errorState">
        <div class="error-icon">‚ö†Ô∏è</div>
        <div class="error-title" id="errorTitle">–û—à–∏–±–∫–∞</div>
        <div class="error-text" id="errorText">–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</div>
        <button id="retryBtn" class="btn btn-primary">–ü–æ–≤—Ç–æ—Ä–∏—Ç—å</button>
      </div>

      <!-- Loading State -->
      <div class="loading-state hidden" id="loadingState">
        <div class="spinner"></div>
        <div class="loading-text">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
      </div>
    </div>

    <!-- User Edit Modal -->
    <div class="modal-overlay hidden" id="modalOverlay">
      <div class="modal" id="userModal">
        <div class="modal-header">
          <h2 class="modal-title" id="modalTitle">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</h2>
          <button class="modal-close" id="modalClose">&times;</button>
        </div>
        <div class="modal-body" id="modalBody">
          <!-- Modal content will be rendered here -->
        </div>
      </div>
    </div>

    <!-- Confirm Dialog -->
    <div class="modal-overlay hidden" id="confirmOverlay">
      <div class="modal modal-small">
        <div class="modal-header">
          <h2 class="modal-title">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ</h2>
        </div>
        <div class="modal-body">
          <p id="confirmText">–í—ã —É–≤–µ—Ä–µ–Ω—ã?</p>
          <div class="modal-actions">
            <button id="confirmCancel" class="btn btn-secondary">–û—Ç–º–µ–Ω–∞</button>
            <button id="confirmOk" class="btn btn-danger">–£–¥–∞–ª–∏—Ç—å</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Broadcast Modal -->
    <div class="modal-overlay hidden" id="broadcastOverlay">
      <div class="modal modal-broadcast">
        <div class="modal-header">
          <h2 class="modal-title">üì¢ –†–∞—Å—Å—ã–ª–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è</h2>
          <button class="modal-close" id="broadcastClose">&times;</button>
        </div>
        <div class="modal-body">
          <!-- Edit Mode -->
          <div id="broadcastEditMode">
            <div class="form-group">
              <label for="broadcastText">–¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è</label>
              <textarea id="broadcastText" class="broadcast-textarea" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è...&#10;&#10;–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è HTML-—Ä–∞–∑–º–µ—Ç–∫–∞:&#10;&lt;b&gt;–∂–∏—Ä–Ω—ã–π&lt;/b&gt;, &lt;i&gt;–∫—É—Ä—Å–∏–≤&lt;/i&gt;, &lt;a href=&quot;url&quot;&gt;—Å—Å—ã–ª–∫–∞&lt;/a&gt;"></textarea>
              <div class="form-hint">–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è: emoji üéâ, HTML-—Ç–µ–≥–∏ (&lt;b&gt;, &lt;i&gt;, &lt;a&gt;, &lt;code&gt;)</div>
            </div>
            <div class="form-group">
              <label for="broadcastPhoto">–§–æ—Ç–æ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
              <div class="photo-upload-area" id="photoUploadArea">
                <input type="file" id="broadcastPhoto" accept="image/*" class="photo-input" />
                <div class="photo-preview hidden" id="photoPreview">
                  <img id="photoPreviewImg" src="" alt="Preview" />
                  <button class="photo-remove" id="photoRemove">&times;</button>
                </div>
                <div class="photo-placeholder" id="photoPlaceholder">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="32" height="32">
                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                    <circle cx="8.5" cy="8.5" r="1.5"/>
                    <polyline points="21 15 16 10 5 21"/>
                  </svg>
                  <span>–ù–∞–∂–º–∏—Ç–µ –∏–ª–∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–æ—Ç–æ</span>
                </div>
              </div>
            </div>
          </div>
          <!-- Preview Mode -->
          <div class="preview-section hidden" id="previewSection">
            <div class="preview-header">
              <span class="preview-title">üëÅ –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Å–æ–æ–±—â–µ–Ω–∏—è</span>
            </div>
            <div class="preview-content" id="previewContent">
              <!-- Preview will be rendered here -->
            </div>
          </div>
          <div class="broadcast-info">
            <span class="info-icon">‚ÑπÔ∏è</span>
            <span>–°–æ–æ–±—â–µ–Ω–∏–µ –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤—Å–µ–º <strong id="broadcastUserCount">0</strong> –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –±–æ—Ç–∞</span>
          </div>
          <div class="modal-actions">
            <button id="broadcastPreview" class="btn btn-preview">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                <circle cx="12" cy="12" r="3"/>
              </svg>
              <span class="preview-btn-text">–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä</span>
            </button>
            <button id="broadcastCancel" class="btn btn-secondary">–û—Ç–º–µ–Ω–∞</button>
            <button id="broadcastSend" class="btn btn-primary btn-broadcast-send">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                <path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z"/>
              </svg>
              –û—Ç–ø—Ä–∞–≤–∏—Ç—å
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Dashboard Modal -->
    <div class="modal-overlay hidden" id="dashboardOverlay">
      <div class="modal modal-dashboard">
        <div class="modal-header">
          <h2 class="modal-title">üìä –î–∞—à–±–æ—Ä–¥ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</h2>
          <button class="modal-close" id="dashboardClose">&times;</button>
        </div>
        <div class="modal-body">
          <div class="dashboard-filters">
            <button class="filter-btn active" data-period="4h">4 —á–∞—Å–∞</button>
            <button class="filter-btn" data-period="8h">8 —á–∞—Å–æ–≤</button>
            <button class="filter-btn" data-period="24h">24 —á–∞—Å–∞</button>
            <button class="filter-btn" data-period="3d">3 –¥–Ω—è</button>
            <button class="filter-btn" data-period="7d">7 –¥–Ω–µ–π</button>
          </div>
          <div class="dashboard-chart-container">
            <div class="dashboard-loading hidden" id="dashboardLoading">
              <div class="spinner"></div>
              <span>–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</span>
            </div>
            <div class="dashboard-empty hidden" id="dashboardEmpty">
              <div class="empty-icon">üì≠</div>
              <div class="empty-title">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</div>
              <div class="empty-text">–ó–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –Ω–µ –±—ã–ª–æ</div>
            </div>
            <canvas id="dashboardChart"></canvas>
          </div>
          <div class="dashboard-legend">
            <div class="legend-item">
              <span class="legend-color" style="background: #6366f1;"></span>
              <span>Active Users ‚Äî —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</span>
            </div>
            <div class="legend-item">
              <span class="legend-color" style="background: #22c55e;"></span>
              <span>–ì–µ–Ω–µ—Ä–∞—Ü–∏–∏ ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–∏–º–µ—Ä–æ–∫</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast hidden" id="toast">
      <span class="toast-message" id="toastMessage"></span>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="config.js"></script>
    <script src="app.js"></script>
  </body>
</html>
